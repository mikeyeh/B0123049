礦石判斷模型
================

資料前處理
----------

### 資料讀取

此資料來源為UCI Machine Learning Repository。

記載礦物與石頭接受各個不同角度的聲波撞擊後，接收到的回聲數值，一共有60個參數，代表使用一特別角度的聲波撞擊礦石所得回聲。另外，分類結果為二元分類，包括礦物 (M) 與石頭 (R) 。

``` r
library(mlbench)
data(Sonar) 
str(Sonar) 
```

    ## 'data.frame':    208 obs. of  61 variables:
    ##  $ V1   : num  0.02 0.0453 0.0262 0.01 0.0762 0.0286 0.0317 0.0519 0.0223 0.0164 ...
    ##  $ V2   : num  0.0371 0.0523 0.0582 0.0171 0.0666 0.0453 0.0956 0.0548 0.0375 0.0173 ...
    ##  $ V3   : num  0.0428 0.0843 0.1099 0.0623 0.0481 ...
    ##  $ V4   : num  0.0207 0.0689 0.1083 0.0205 0.0394 ...
    ##  $ V5   : num  0.0954 0.1183 0.0974 0.0205 0.059 ...
    ##  $ V6   : num  0.0986 0.2583 0.228 0.0368 0.0649 ...
    ##  $ V7   : num  0.154 0.216 0.243 0.11 0.121 ...
    ##  $ V8   : num  0.16 0.348 0.377 0.128 0.247 ...
    ##  $ V9   : num  0.3109 0.3337 0.5598 0.0598 0.3564 ...
    ##  $ V10  : num  0.211 0.287 0.619 0.126 0.446 ...
    ##  $ V11  : num  0.1609 0.4918 0.6333 0.0881 0.4152 ...
    ##  $ V12  : num  0.158 0.655 0.706 0.199 0.395 ...
    ##  $ V13  : num  0.2238 0.6919 0.5544 0.0184 0.4256 ...
    ##  $ V14  : num  0.0645 0.7797 0.532 0.2261 0.4135 ...
    ##  $ V15  : num  0.066 0.746 0.648 0.173 0.453 ...
    ##  $ V16  : num  0.227 0.944 0.693 0.213 0.533 ...
    ##  $ V17  : num  0.31 1 0.6759 0.0693 0.7306 ...
    ##  $ V18  : num  0.3 0.887 0.755 0.228 0.619 ...
    ##  $ V19  : num  0.508 0.802 0.893 0.406 0.203 ...
    ##  $ V20  : num  0.48 0.782 0.862 0.397 0.464 ...
    ##  $ V21  : num  0.578 0.521 0.797 0.274 0.415 ...
    ##  $ V22  : num  0.507 0.405 0.674 0.369 0.429 ...
    ##  $ V23  : num  0.433 0.396 0.429 0.556 0.573 ...
    ##  $ V24  : num  0.555 0.391 0.365 0.485 0.54 ...
    ##  $ V25  : num  0.671 0.325 0.533 0.314 0.316 ...
    ##  $ V26  : num  0.641 0.32 0.241 0.533 0.229 ...
    ##  $ V27  : num  0.71 0.327 0.507 0.526 0.7 ...
    ##  $ V28  : num  0.808 0.277 0.853 0.252 1 ...
    ##  $ V29  : num  0.679 0.442 0.604 0.209 0.726 ...
    ##  $ V30  : num  0.386 0.203 0.851 0.356 0.472 ...
    ##  $ V31  : num  0.131 0.379 0.851 0.626 0.51 ...
    ##  $ V32  : num  0.26 0.295 0.504 0.734 0.546 ...
    ##  $ V33  : num  0.512 0.198 0.186 0.612 0.288 ...
    ##  $ V34  : num  0.7547 0.2341 0.2709 0.3497 0.0981 ...
    ##  $ V35  : num  0.854 0.131 0.423 0.395 0.195 ...
    ##  $ V36  : num  0.851 0.418 0.304 0.301 0.418 ...
    ##  $ V37  : num  0.669 0.384 0.612 0.541 0.46 ...
    ##  $ V38  : num  0.61 0.106 0.676 0.881 0.322 ...
    ##  $ V39  : num  0.494 0.184 0.537 0.986 0.283 ...
    ##  $ V40  : num  0.274 0.197 0.472 0.917 0.243 ...
    ##  $ V41  : num  0.051 0.167 0.465 0.612 0.198 ...
    ##  $ V42  : num  0.2834 0.0583 0.2587 0.5006 0.2444 ...
    ##  $ V43  : num  0.282 0.14 0.213 0.321 0.185 ...
    ##  $ V44  : num  0.4256 0.1628 0.2222 0.3202 0.0841 ...
    ##  $ V45  : num  0.2641 0.0621 0.2111 0.4295 0.0692 ...
    ##  $ V46  : num  0.1386 0.0203 0.0176 0.3654 0.0528 ...
    ##  $ V47  : num  0.1051 0.053 0.1348 0.2655 0.0357 ...
    ##  $ V48  : num  0.1343 0.0742 0.0744 0.1576 0.0085 ...
    ##  $ V49  : num  0.0383 0.0409 0.013 0.0681 0.023 0.0264 0.0507 0.0285 0.0777 0.0092 ...
    ##  $ V50  : num  0.0324 0.0061 0.0106 0.0294 0.0046 0.0081 0.0159 0.0178 0.0439 0.0198 ...
    ##  $ V51  : num  0.0232 0.0125 0.0033 0.0241 0.0156 0.0104 0.0195 0.0052 0.0061 0.0118 ...
    ##  $ V52  : num  0.0027 0.0084 0.0232 0.0121 0.0031 0.0045 0.0201 0.0081 0.0145 0.009 ...
    ##  $ V53  : num  0.0065 0.0089 0.0166 0.0036 0.0054 0.0014 0.0248 0.012 0.0128 0.0223 ...
    ##  $ V54  : num  0.0159 0.0048 0.0095 0.015 0.0105 0.0038 0.0131 0.0045 0.0145 0.0179 ...
    ##  $ V55  : num  0.0072 0.0094 0.018 0.0085 0.011 0.0013 0.007 0.0121 0.0058 0.0084 ...
    ##  $ V56  : num  0.0167 0.0191 0.0244 0.0073 0.0015 0.0089 0.0138 0.0097 0.0049 0.0068 ...
    ##  $ V57  : num  0.018 0.014 0.0316 0.005 0.0072 0.0057 0.0092 0.0085 0.0065 0.0032 ...
    ##  $ V58  : num  0.0084 0.0049 0.0164 0.0044 0.0048 0.0027 0.0143 0.0047 0.0093 0.0035 ...
    ##  $ V59  : num  0.009 0.0052 0.0095 0.004 0.0107 0.0051 0.0036 0.0048 0.0059 0.0056 ...
    ##  $ V60  : num  0.0032 0.0044 0.0078 0.0117 0.0094 0.0062 0.0103 0.0053 0.0022 0.004 ...
    ##  $ Class: Factor w/ 2 levels "M","R": 2 2 2 2 2 2 2 2 2 2 ...

### 將資料隨機分為訓練組與測試組

隨機將2/3的資料分到訓練組（Test==F），剩下1/3為測試組（Test==T）

``` r
Sonar$Test<-F 
Sonar[sample(1:nrow(Sonar),nrow(Sonar)/3),]$Test<-T 
c(sum(Sonar$Test==F),sum(Sonar$Test==T)) 
```

    ## [1] 139  69

可得訓練組案例數為139，測試組案例數為69

預測模型建立
------------

### 模型建立

由於變數多，且多為連續變項，而輸出為二元類別變項，故選擇邏輯迴歸演算法建立模型，並使用雙向逐步選擇最佳參數組合。

``` r
fit<-glm(Class~., Sonar[Sonar$Test==F,],family="binomial")
library(MASS)
finalFit<-stepAIC(fit,direction = "both",trace = F)
summary(finalFit)$coefficients
```

    ##                Estimate Std. Error      z value  Pr(>|z|)
    ## (Intercept)   -1296.666   324836.1 -0.003991753 0.9968151
    ## V3            26720.961  1983101.7  0.013474327 0.9892494
    ## V4           -18754.498   961403.0 -0.019507425 0.9844363
    ## V6           -34511.918  1171337.0 -0.029463697 0.9764948
    ## V7            30119.518   766917.6  0.039273471 0.9686724
    ## V12          -13848.595   799876.5 -0.017313417 0.9861866
    ## V17           18291.138   973533.0  0.018788411 0.9850099
    ## V19          -14767.935  1494484.6 -0.009881624 0.9921157
    ## V20           11478.039  1498991.3  0.007657175 0.9938905
    ## V22          -10905.996   874194.3 -0.012475482 0.9900463
    ## V25            5688.037   267457.0  0.021267106 0.9830326
    ## V29            9957.017   323382.7  0.030790194 0.9754369
    ## V30          -17635.999  1073532.6 -0.016428006 0.9868929
    ## V31           25806.500  2065977.1  0.012491184 0.9900337
    ## V32          -25322.928  1442525.2 -0.017554582 0.9859942
    ## V33           13573.556   689414.0  0.019688542 0.9842918
    ## V35          -23964.907  1417737.3 -0.016903630 0.9865135
    ## V36           37861.781  1750484.8  0.021629311 0.9827437
    ## V37          -14887.223   952456.2 -0.015630349 0.9875293
    ## V40           15167.936   528164.5  0.028718205 0.9770893
    ## V45          -24965.108   930663.9 -0.026825052 0.9785993
    ## V46           48849.367  1924626.5  0.025381220 0.9797509
    ## V47          -39851.227   964399.5 -0.041322322 0.9670389
    ## V49          -75801.091  3490074.5 -0.021719046 0.9826721
    ## V51          157354.954  3765658.0  0.041786841 0.9666686
    ## V53         -204831.222 12100124.0 -0.016928027 0.9864940
    ## V54           65917.919  6540538.0  0.010078363 0.9919588
    ## V57         -261409.628 18211430.4 -0.014354151 0.9885474
    ## V59         -106010.141 13128827.1 -0.008074609 0.9935575

### 模型說明

由上述參數可知，使用聲波在不同角度撞擊`礦石`所得到的回聲資料，以邏輯迴歸建立模型預測礦石是否為礦物，經最佳化後，模型使用參數為V3, V4, V6, V7, V12, V17, V19, V20, V22, V25, V29, V30, V31, V32, V33, V35, V36, V37, V40, V45, V46, V47, V49, V51, V53, V54, V57, V59，共29個參數，各參數代表從一特別角度所得的礦石回聲

預測模型驗證
------------

``` r
MinePred<-predict(finalFit,newdata = Sonar[Sonar$Test==T,])
MineAns<-ifelse(MinePred<0.5,"M","R") #<0.5: Level 1
MineAns<-factor(MineAns,levels = c("M","R"))
library(caret)
sensitivity(MineAns,Sonar[Sonar$Test==T,]$Class)
```

    ## [1] 0.8717949

``` r
specificity(MineAns,Sonar[Sonar$Test==T,]$Class)
```

    ## [1] 0.9

``` r
posPredValue(MineAns,Sonar[Sonar$Test==T,]$Class)
```

    ## [1] 0.9189189

``` r
negPredValue(MineAns,Sonar[Sonar$Test==T,]$Class)
```

    ## [1] 0.84375

使用聲波在不同角度撞擊`礦石`所得到的回聲資料，以邏輯迴歸模型預測礦石是否為礦物，可得：

-   敏感度 87.1794872%
-   特異性 90%
-   陽性預測率 91.8918919%
-   陰性預測率 84.375%
